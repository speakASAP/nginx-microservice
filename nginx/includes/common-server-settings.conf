# Common server-level settings for all HTTPS servers
# This file is included in all HTTPS server blocks to avoid duplication

# HTTP/2 support is configured in the listen directive (listen 443 ssl http2;)
# This avoids duplicate http2 directive errors

# Security headers (common for all HTTPS servers)
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

# Rate limiting (common for all servers)
limit_req zone=general burst=50 nodelay;

# Deny access to hidden files (common for all servers)
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

# Deny access to sensitive files (common for all servers)
location ~* \.(env|git|svn|htaccess|htpasswd|ini|log|sh|sql|conf|bak|swp|swo)$ {
    deny all;
}

# Error pages (common for all servers)
error_page 404 /404.html;
error_page 500 502 503 504 /50x.html;
location = /50x.html {
    root /usr/share/nginx/html;
    internal;
}
